<!DOCTYPE html>
<html lang="zh">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme-color" content=#58b77a>
  <title>test | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="dugushang">
  <meta name="keywords" content="">
  <meta name="description" content="">
  <script id="hexo-configurations">
  var CONFIG = {
    root: '/',
    theme: 'lx',
    version: '0.4.3',
    localsearch:{
      "enable": false,
      "trigger": "auto",
      "top_n_per_article": 1,
      "unescape": false,
      "preload": false
      },
    path: 'null'
  };
</script>

  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="https://unpkg.com/theme-lx@0.4.3/source/dist/css/main.min.css">
  
  <style type="text/css">
    pre,
    code {
      font-family: 'Fira Code', monospace;
    }
    html {
      font-family: sans-serif;
    }
    body {
      font-family: sans-serif;
    }
    h1, h2, h3, h4, h5, figure {
      font-family: sans-serif;
    }
    .menu-container{
      font-family: sans-serif;
    }
  </style>

  <script src="https://unpkg.com/jquery@3.4.1/dist/jquery.min.js"></script>
  <script src="https://unpkg.com/theme-lx@0.4.3/source/dist/js/jquery.jside.menu.min.js"></script>
	<script>
	$(document).ready(function(){
	$(".menu-container").jSideMenu({
	    jSidePosition: "position-right",
	    jSideSticky: true,
	    jSideSkin: "",
	     });
	}); 
	</script>
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
  <link rel="stylesheet" href="https://unpkg.com/font-awesome@4/css/font-awesome.min.css">
<meta name="generator" content="Hexo 6.2.0"></head>
<body>
<div class="single">

<div id="page">
<div class="header">
  <div id="lx-aside" style="background-image: url(https://unpkg.com/theme-lx@0.4.3/source/dist/images/post_cover.min.jpeg)" data-stellar-background-ratio="0.5">
    <div class="overlay">
      
      <div class="page-title">
        <div class="avatar"><a href="/"><img src="https://unpkg.com/theme-lx@0.4.3/source/dist/images/avatar.min.jpeg" alt="dugushang"></a></div>
        <span>2022-07-11</span>
        <h2>test</h2>
        
        
      </div>
    </div>
  </div>
</div>
<div id="lx-main-content">
  <div class="lx-post">
    <div class="lx-entry padding">
      <div>
        <p>#include”reg52.h”<br>#include”key.h”<br>#include “iic.h”<br>#include “intrins.h”</p>
<p>sfr AUXR &#x3D; 0x8e;</p>
<p>#define u8 unsigned char<br>#define u16 unsigned int<br>#define somenop {<em>nop</em>(); <em>nop</em>(); <em>nop</em>();}</p>
<p>sbit TX &#x3D; P1^0;<br>sbit RX &#x3D; P1^1;</p>
<p>code u8 smg_du[] &#x3D; {0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};<br>code u8 smg_we[] &#x3D; {0x80,0x40,0x20,0x10,0x08,0x04,0x02,0x01};<br>u8 frency_table[] &#x3D; {0xc0,0xc0,0xc0,0xc0,0xc0,0xc0,0xff,0x8e};<br>u8 sonic_table[] &#x3D; {0xc0,0xc0,0xc0,0xff,0xff,0xff,0xff,0x88};<br>u8 hum_table[] &#x3D; {0xc0,0xc0,0xff,0xff,0xff,0xff,0xff,0x89};<br>u8 par_table[] &#x3D; {0xc0,0xc0,0xff,0xff,0xff,0xff,0xff,0x8c};<br>u8 hum;<br>float dac;<br>float time;<br>u16 distance;<br>u16 sonic_state;<br>u16 frency;<br>u16 count_f;<br>bit key_flag,dac_flag,sonic_flag;<br>bit flash;<br>extern u8 trg &#x3D; 0,cont &#x3D; 0;<br>extern u8 interface_state &#x3D; 0;<br>extern u8 par_state &#x3D; 0;<br>extern u8 fre_par &#x3D; 90,hum_par &#x3D; 40;distance_par &#x3D; 6;<br>extern bit data_show_flag_m &#x3D; 1;<br>extern bit data_show_flag_f &#x3D; 1;</p>
<p>void Timer0init(void);<br>void table_convert();<br>u16 get_sonic();<br>void led_proc();</p>
<p>void main()<br>{<br>    P2 &#x3D; (P2 &amp; 0x1f) | 0xa0; P0 &#x3D; 0x00; P2 &amp;&#x3D; 0x1f;<br>    P2 &#x3D; (P2 &amp; 0x1f) | 0x80; P0 &#x3D; 0xff; P2 &amp;&#x3D; 0x1f;	<br>    read_24c02(0x01);<br>    Timer0init();<br>    while(1)<br>    {<br>        Timer0init();<br>        write_24c02(0x01,1);<br>        if(key_flag){key_flag &#x3D; 0;Keyproc();}<br>        table_convert();<br>        if(interface_state &#x3D;&#x3D; 2)<br>        {<br>            if(sonic_flag){sonic_flag &#x3D; 0;sonic_state &#x3D; get_sonic();}	<br>        }<br>        led_proc();<br>        if(dac_flag)<br>        {<br>            dac	&#x3D; read_8591(3);<br>            hum &#x3D; (u16)(dac *100 &#x2F; 51.0f) &#x2F; 5;</p>
<pre><code>        if(hum &lt; hum_par)
        &#123;
            write_8591(51);
        &#125;
        else if(hum &gt; 80)
            &#123;
             	write_8591(255);
            &#125;
            else if((hum &gt; hum_par)&amp;&amp;(hum &lt; 80))
            &#123;				
                    write_8591(hum * ((80-hum_par)/4));
            &#125;	
    &#125;
    if(sonic_state &gt;distance_par)
    &#123;
</code></pre>
<p>&#x2F;&#x2F;			P2 &#x3D; (P2 &amp; 0x1f) | 0xa0; P0 &#x3D; ~0x10; P2 &amp;&#x3D; 0x1f;	<br>        }<br>        else<br>        {<br>          	P2 &#x3D; (P2 &amp; 0x1f) | 0xa0; P0 &#x3D; 0x00; P2 &amp;&#x3D; 0x1f;<br>        }<br>    }<br>}</p>
<p>void display();<br>void Timer0isr() interrupt 1<br>{<br>    static u8 count_key ,count_dac,count_sonic,count_f;<br>    count_dac++; count_key++; count_sonic++;</p>
<pre><code>if(count_sonic&gt;= 100)
&#123;
    count_sonic = 0;
    sonic_flag = 1;
&#125;

if(count_key &gt;= 6)
&#123;
    count_key = 0;
    key_flag = 1;
&#125;

if(count_dac &gt;= 150)
&#123;
    count_dac = 0;
    dac_flag = 1;	
&#125;

if(count_f &gt;= 50)	//0.1s
&#123;
 	count_f = 0;
    flash = 1;
&#125;
display();
</code></pre>
<p>}</p>
<p>void display()<br>{<br>    static u8 i;<br>    P0 &#x3D; 0xff; P2 &#x3D; (P2 &amp; 0x1f) | 0xe0; P2 &amp;&#x3D; 0x1f;<br>    P0 &#x3D; smg_we[i]; P2 &#x3D; (P2 &amp; 0x1f) | 0xc0; P2 &amp;&#x3D; 0x1f;<br>    if(interface_state &#x3D;&#x3D; 0){P0 &#x3D; frency_table[i]; P2 &#x3D; (P2 &amp; 0x1f) | 0xe0; P2 &amp;&#x3D; 0x1f;}<br>    if(interface_state &#x3D;&#x3D; 1){P0 &#x3D; hum_table[i]; P2 &#x3D; (P2 &amp; 0x1f) | 0xe0; P2 &amp;&#x3D; 0x1f;}<br>    if(interface_state &#x3D;&#x3D; 2){P0 &#x3D; sonic_table[i]; P2 &#x3D; (P2 &amp; 0x1f) | 0xe0; P2 &amp;&#x3D; 0x1f;}<br>    if(interface_state &#x3D;&#x3D; 3){P0 &#x3D; par_table[i]; P2 &#x3D; (P2 &amp; 0x1f) | 0xe0; P2 &amp;&#x3D; 0x1f;}	 				<br>    i++;if(i &gt;&#x3D; 8)i &#x3D; 0;<br>}</p>
<p>void table_convert()<br>{</p>
<pre><code>if(interface_state == 0)
&#123;		
 	if(data_show_flag_f)
    &#123;
    
        
    &#125;
    else
    &#123;
    


    &#125;			
&#125;

if(interface_state == 1)
   &#123;
    hum_table[0] = smg_du[hum % 10];
    hum_table[1] = smg_du[hum / 10];

&#125;

if(interface_state == 2)
&#123;
    if(data_show_flag_m)
    &#123;
        sonic_table[0]  = smg_du[sonic_state % 10];
        sonic_table[1]  = smg_du[sonic_state / 10 % 10];
        sonic_table[2]  = smg_du[sonic_state /100 % 10];
    &#125;
    else
    &#123;
        sonic_table[0]  = smg_du[sonic_state % 10];
        sonic_table[1]  = smg_du[sonic_state / 10 % 10];
        sonic_table[2]  = smg_du[sonic_state /100 % 10] &amp; 0x7f;
    
    &#125;
&#125;

if(interface_state == 3)
&#123;
 	if(par_state == 0)
    &#123;
  		par_table[0] = smg_du[fre_par % 10];
        par_table[1] = smg_du[fre_par / 10 % 10] &amp; 0x7f;
        par_table[1] = smg_du[fre_par / 100] ;
        par_table[6] = smg_du[1];
    &#125;
  	if(par_state == 1)
   	&#123;
       	par_table[0] = smg_du[hum_par% 10];
        par_table[1] = smg_du[hum_par / 10];
        par_table[6] = smg_du[2];
    &#125;
  	if(par_state == 2)
  	&#123;	
  	  	par_table[0] = smg_du[distance_par % 10];
        par_table[1] = smg_du[distance_par / 10] &amp; 0x7f;
        par_table[6] = smg_du[3];
  	&#125;

&#125;					
</code></pre>
<p>}</p>
<p>void led_proc()<br>{<br>    static u8 led_state &#x3D; 0xff;<br>    if(interface_state &#x3D;&#x3D; 0)<br>    {<br>        led_state &amp;&#x3D; ~0x01;	<br>    }<br>    else<br>    {<br>     	led_state |&#x3D; 0x01;<br>    }</p>
<pre><code>if(interface_state == 1)
&#123;
    led_state &amp;= ~0x02;
&#125;
else
&#123;	
    led_state |= 0x02;
&#125;

if(interface_state == 2)
&#123;
   led_state &amp;= ~0x04;
&#125;
else
&#123;
 	led_state |= 0x04;
&#125;
if(frency &gt; fre_par)
&#123;
  	led_state &amp;= ~0x08;
&#125;
else
&#123;
    led_state |= 0x08;
&#125;
if(hum &gt; hum_par)
&#123;
   	led_state &amp;= ~0x10;
&#125;
else
&#123;
  	led_state |= 0x10;
&#125;
if(sonic_state &gt; distance_par)
&#123;
  	led_state &amp;= ~0x20;
&#125;
else
&#123;
    led_state |= 0x20;
&#125;
P2 = (P2 &amp; 0x1f) | 0x80; P0 = led_state; P2 &amp;= 0x1f;
</code></pre>
<p>}</p>
<p>void send_sonic()<br>{<br>    u8 x,i &#x3D; 8;<br>    do {<br>        TX &#x3D; 1;<br>        for(x &#x3D; 0; x &lt; 17;x++)<br>        somenop</p>
<pre><code>    TX = 0;
    for(x = 0; x &lt; 17;x++)
    somenop
    &#125;while(i--);
</code></pre>
<p>}</p>
<p>u16 get_sonic()<br>{	<br>    send_sonic();<br>    TR1 &#x3D; 1;<br>    while((RX &#x3D;&#x3D; 1)&amp;&amp;(TF1 &#x3D;&#x3D; 0));	<br>    TR1 &#x3D; 0;<br>    if(TF1 &#x3D;&#x3D; 1)<br>    {<br>        TF1 &#x3D; 0;<br>    }<br>    else<br>    {<br>     	time &#x3D; TH1 *256 + TL1;<br>        distance &#x3D; (u16)(0.017 * time);	<br>    }<br>    TH1 &#x3D; 0;<br>    TL1 &#x3D; 0;<br>    return distance;	<br>}</p>
<p>void Timer0Init(void)		&#x2F;&#x2F;2毫秒@12.000MHz<br>{<br>    AUXR |&#x3D; 0x80;		&#x2F;&#x2F;定时器时钟1T模式<br>    TMOD &amp;&#x3D; 0xF0;		&#x2F;&#x2F;设置定时器模式<br>    TL0 &#x3D; 0x40;		&#x2F;&#x2F;设置定时初始值<br>    TH0 &#x3D; 0xA2;		&#x2F;&#x2F;设置定时初始值<br>    TF0 &#x3D; 0;		&#x2F;&#x2F;清除TF0标志<br>    TR0 &#x3D; 1;		&#x2F;&#x2F;定时器0开始计时<br>    ET0 &#x3D; 1;<br>    EA &#x3D; 1;	<br>}</p>

      </div>
    </div>
  </div>
</div>
<div class="lx-navigation">
	<div class="lx-cover next lx-cover-sm" style="background-image: url(https://unpkg.com/theme-lx@0.4.3/source/dist/images/footer-l.min.jpeg)">
		<div class="overlay"></div>
		<a class="copy" href="#">
			<div class="display-t">
				<div class="display-tc">
					<div>
						<span>Next</span>
						<h3>没有更新的文章</h3>
					</div>
				</div>
			</div>
		</a>
	</div>
        <div class="lx-cover prev lx-cover-sm" style="background-image: url(https://unpkg.com/theme-lx@0.4.3/source/dist/images/footer-r.min.jpeg)">
		<div class="overlay"></div>
		<a class="copy" href="/2022/07/10/my-frist-blog/">
			<div class="display-t">
				<div class="display-tc">
					<div>
						<span>Prev</span>
						<h3>人生第一次</h3>
					</div>
				</div>
			</div>
		</a>
	</div>
</div>

</div>

<footer>
  <div>
  Copyright &copy; 2022.<a href="/">Hexo</a><br>Powered by <a href="https://hexo.io" target="_blank">Hexo</a> | Theme <a href="https://lx.js.org" target="_blank">Lx</a><br>
  </div>
</footer>

</div>

<button class="hamburger hamburger--arrow-r" type="button" title="menu">
    <div class="hamburger-box">
      <div class="hamburger-inner"></div>
    </div>
</button>
<div class="menu visibility">
  <div class="menu-head">
    <span class="layer">
      <div class="col">
        <div class="row for-pic">
          <div class="profile-pic">
            <a href="/"><img src="https://unpkg.com/theme-lx@0.4.3/source/dist/images/avatar.min.jpeg" alt="dugushang"/></a>
          </div>
        </div>
        <div class="row for-name">
          <p>dugushang</p>
          <span class="tagline">Hello, Welcome my blog!</span>
        </div>
      </div>
    </span>
  </div>
  <nav class="menu-container">
  <ul class="menu-items">
    <li><a href="/"><i class="fa fa-home fa-fw"></i>首页</a></li>
    <li><a href="/archives/"><i class="fa fa-archive fa-fw"></i>归档</a></li>
    
    <li class="has-sub"><span class="dropdown-heading">
      <i class="fa fa-bookmark fa-fw"></i>页面</span>
        <ul>
          <li><a href="/guestbook/">Guestbook</a></li>
        <li><a href="/about/">About</a></li>
        </ul>
    </li>
    <li class="has-sub"><span class="dropdown-heading">
      <i class="fa fa-link fa-fw"></i>友链</span>
        <ul>
          <li> <a href="https://lx.js.org" target="_blank">Theme-Lx</a></li>
        </ul>
    </li>
  </ul>
  </nav>
</div>

<div class="gototop js-top">
  <a href="#" class="js-gotop"><i class="fa fa-arrow-up"></i></a>
</div>
<script src="https://unpkg.com/theme-lx@0.4.3/source/dist/js/jquery.easing.min.js"></script>
<script>
(function () {
	"use strict";
	var goToTop = function() {
		$(".js-gotop").on("click", function(event){
			event.preventDefault();
			$("html, body").animate({
				scrollTop: $("html").offset().top
			}, 500, "easeInOutExpo");
			return false;
		});
		$(window).scroll(function(){
			var $win = $(window);
			if ($win.scrollTop() > 200) {
				$(".js-top").addClass("active");
			} else {
				$(".js-top").removeClass("active");
			}
		});
	};
	$(function(){
		goToTop();
	});
}());
</script>


</body>
</html>
